{"ast":null,"code":"import _slicedToArray from\"/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import React,{Component,useContext,useState}from'react';import{saveAs}from'file-saver';import AudioReactRecorder,{RecordState}from'audio-react-recorder';import styled from'styled-components';import{ContextApp}from'../ContextAPI';import firebase from'firebase';import{db}from'../Fire';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Iconspecial=styled.i(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\ncolor: \",\";\\nbackground-color: white;\\n&:hover {\\n  color: white;\\n  background-color:  \",\";\\n}\\n\"])),function(props){return props.color;},function(props){return props.color;});function Recorder(props){var user=firebase.auth().currentUser;var convoid=props.convoid,progressbar=props.progressbar,progresswidth=props.progresswidth;var _useContext=useContext(ContextApp),themecolor=_useContext.themecolor;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),record=_useState2[0],setRecord=_useState2[1];var _useState3=useState('blob:https://5guz4.csb.app/2ff8746b-44d6-4c3f-b531-480291e7aa84'),_useState4=_slicedToArray(_useState3,2),audio=_useState4[0],setAudio=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),update=_useState6[0],setUpdate=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),clicked=_useState8[0],setClicked=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),reset=_useState10[0],setReset=_useState10[1];var id=db.collection('conversations').doc().id;function start(){setRecord(RecordState.START);}function stop(){setRecord(RecordState.STOP);}//audioData contains blob and blobUrl\nvar onStop=function onStop(audioData){if(!reset){var FileSaver=require('file-saver');var storageRef=firebase.storage().ref(\"\".concat(convoid,\"/recording.mp3\"));var reader=new FileReader();reader.readAsDataURL(audioData.blob);reader.onloadend=function(){var base64data=reader.result;function urltoFile(url,filename,mimeType){return fetch(url).then(function(res){return res.arrayBuffer();}).then(function(buf){return new File([buf],filename,{type:mimeType});});}//Usage example:\nurltoFile(base64data,'recording.wav','audio/wav').then(function(file){var storageRef=firebase.storage().ref(\"\".concat(convoid,\"/\").concat(id,\".wav\"));var task=storageRef.put(file);task.on('state_changes',function progress(snap){progressbar.current.style.display='flex';var percentage=snap.bytesTransferred/snap.totalBytes*100;progresswidth.current.style.height=\"\".concat(percentage,\"%\");},function error(err){},function complete(){var msgobject={message:\"https://firebasestorage.googleapis.com/v0/b/\".concat(storageRef.bucket,\"/o/\").concat(convoid,\"%2F\").concat(id,\".wav?alt=media\"),reaction:\"\",msgdate:firebase.firestore.Timestamp.now(),msgid:db.collection(\"conversations\").doc().id,read:false,senderid:user.uid,editing:false,nobackground:true,emoji:true,base64:false,audio:true};db.collection(\"conversations\").doc(convoid).update({messages:firebase.firestore.FieldValue.arrayUnion(msgobject)});progressbar.current.style.display='none';});});};}else{setReset(false);}};var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),time=_useState12[0],setTime=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),intervalId=_useState14[0],setIntervalId=_useState14[1];function startRecord(){start();setClicked(true);setIntervalId(setInterval(function(){setTime(function(prev){return prev+1;});},1000));}function stopRecord(){setTime(0);stop();setClicked(false);clearInterval(intervalId);}function resetRecord(){setReset(true);stop();}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AudioReactRecorder,{state:record,onStop:onStop}),!clicked?/*#__PURE__*/_jsx(Iconspecial,{color:themecolor,className:\"icondiv fal fa-microphone\",onClick:function onClick(){startRecord();}}):/*#__PURE__*/_jsxs(\"div\",{class:\"spinner-wave\",onClick:function onClick(){stopRecord();},children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:time}),/*#__PURE__*/_jsx(Iconspecial,{color:themecolor,className:\"left fal fa-times-circle\",onClick:function onClick(){return resetRecord();}})]})]});}export default Recorder;","map":{"version":3,"names":["React","Component","useContext","useState","saveAs","AudioReactRecorder","RecordState","styled","ContextApp","firebase","db","Iconspecial","i","props","color","Recorder","user","auth","currentUser","convoid","progressbar","progresswidth","themecolor","record","setRecord","audio","setAudio","update","setUpdate","clicked","setClicked","reset","setReset","id","collection","doc","start","START","stop","STOP","onStop","audioData","FileSaver","require","storageRef","storage","ref","reader","FileReader","readAsDataURL","blob","onloadend","base64data","result","urltoFile","url","filename","mimeType","fetch","then","res","arrayBuffer","buf","File","type","file","task","put","on","progress","snap","current","style","display","percentage","bytesTransferred","totalBytes","height","error","err","complete","msgobject","message","bucket","reaction","msgdate","firestore","Timestamp","now","msgid","read","senderid","uid","editing","nobackground","emoji","base64","messages","FieldValue","arrayUnion","time","setTime","intervalId","setIntervalId","startRecord","setInterval","prev","stopRecord","clearInterval","resetRecord"],"sources":["/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/src/components/Recorder.js"],"sourcesContent":["import React, { Component, useContext, useState } from 'react'\r\nimport { saveAs } from 'file-saver';\r\n\r\nimport AudioReactRecorder, { RecordState } from 'audio-react-recorder'\r\nimport styled from 'styled-components'  \r\nimport { ContextApp } from '../ContextAPI'\r\nimport firebase from 'firebase'\r\nimport { db } from '../Fire'\r\n\r\nconst Iconspecial = styled.i `\r\ncolor: ${props=>props.color};\r\nbackground-color: white;\r\n&:hover {\r\n  color: white;\r\n  background-color:  ${props=>props.color};\r\n}\r\n`\r\nfunction Recorder(props) {\r\n  \r\n  const user = firebase.auth().currentUser\r\n  const {convoid, progressbar, progresswidth}=props\r\n  const {themecolor}= useContext(ContextApp)\r\n  const [record, setRecord] = useState(null)\r\n  const [audio, setAudio] = useState('blob:https://5guz4.csb.app/2ff8746b-44d6-4c3f-b531-480291e7aa84')\r\n  const [update, setUpdate]=useState(0)\r\n  const [clicked, setClicked]=useState(false)\r\n  const [reset, setReset]=useState(false)\r\n  let id = db.collection('conversations').doc().id\r\n\r\n  function start() {\r\n    setRecord(RecordState.START)\r\n  }\r\n \r\n  function stop() {\r\n      setRecord(RecordState.STOP)\r\n  }\r\n  //audioData contains blob and blobUrl\r\n    const onStop = (audioData) => {\r\n    if(!reset){\r\n      var FileSaver = require('file-saver');\r\n      const storageRef =  firebase.storage().ref(`${convoid}/recording.mp3`)\r\n      var reader = new FileReader();\r\n      reader.readAsDataURL(audioData.blob); \r\n      reader.onloadend = function() {\r\n          var base64data = reader.result;                \r\n          function urltoFile(url, filename, mimeType){\r\n            return (fetch(url)\r\n                .then(function(res){return res.arrayBuffer();})\r\n                .then(function(buf){return new File([buf], filename,{type:mimeType});})\r\n            );\r\n        }\r\n        \r\n        //Usage example:\r\n        urltoFile(base64data, 'recording.wav','audio/wav')\r\n        .then(\r\n          function(file){ \r\n\r\n              const storageRef =  firebase.storage().ref(`${convoid}/${id}.wav`)\r\n\r\n    const task =  storageRef.put(file)\r\n      task.on('state_changes',\r\n\r\n        function progress(snap){\r\n          progressbar.current.style.display='flex'\r\n          const percentage =( snap.bytesTransferred/snap.totalBytes)*100\r\n         progresswidth.current.style.height=`${percentage}%`\r\n        }, \r\n        function error(err){\r\n\r\n        },\r\n        function complete(){\r\n  \r\n              let msgobject = {\r\n            message: `https://firebasestorage.googleapis.com/v0/b/${storageRef.bucket}/o/${convoid}%2F${id}.wav?alt=media`,\r\n            reaction: \"\",\r\n            msgdate: firebase.firestore.Timestamp.now(),\r\n            msgid: db.collection(\"conversations\").doc().id,\r\n            read: false,\r\n            senderid: user.uid,\r\n            editing: false,\r\n            nobackground: true,\r\n            emoji: true,\r\n            base64: false,\r\n            audio: true\r\n          };\r\n          db.collection(\"conversations\")\r\n          .doc(convoid)\r\n          .update({\r\n            messages: firebase.firestore.FieldValue.arrayUnion(msgobject)\r\n          });\r\n          progressbar.current.style.display='none'\r\n\r\n    })    \r\n          });\r\n\r\n}\r\n\r\n    }else {\r\n      setReset(false)\r\n    }\r\n  }\r\n  \r\n  const [time, setTime] = useState(0)\r\n  const [intervalId, setIntervalId] = useState();\r\n  function startRecord() {\r\n      start()\r\n      setClicked(true)\r\n      setIntervalId(setInterval(() => {\r\n          setTime(prev => prev + 1)\r\n      }, 1000));\r\n  }\r\n  \r\n  function stopRecord() {\r\n      setTime(0)\r\n      stop()\r\n      setClicked(false)\r\n      clearInterval(intervalId);\r\n  }\r\n  function resetRecord(){\r\n    setReset(true)\r\n    stop()\r\n  }\r\n    return (\r\n      <>\r\n        <AudioReactRecorder state={record} onStop={onStop} />\r\n        {!clicked?<Iconspecial color={themecolor} className='icondiv fal fa-microphone' onClick={()=>{startRecord(); }}></Iconspecial>:\r\n        <div class=\"spinner-wave\" onClick={()=>{stopRecord(); }}>\r\n        <div></div>\r\n        <div></div>\r\n        <div></div>\r\n        <div></div>\r\n        <div></div>\r\n       \r\n        <span className=\"time\">\r\n          {time}\r\n        </span>\r\n        <Iconspecial color={themecolor} className=\"left fal fa-times-circle\" onClick={()=>resetRecord()}></Iconspecial>\r\n\r\n      </div>\r\n      }\r\n        {/* <button onClick={()=>start()}>Start</button>\r\n        <button onClick={()=>stop()}>Stop</button> */}\r\n      </>\r\n    )\r\n  }\r\n\r\nexport default Recorder"],"mappings":"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"},"metadata":{},"sourceType":"module"}