{"ast":null,"code":"import _slicedToArray from\"/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import{BrowserRouter as Router,Switch,Route,Link,NavLink,Redirect}from\"react-router-dom\";import firebase from'firebase';import{db}from'../Fire';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Users(props){// const [name, setName]=useState('')\n// const [img, setImg]=useState('')\n// const [city, setCity]=useState('')\n// const [country, setCountry]=useState('')\n// const [job, setJob]=useState('')\n// const [recipnumber, setRecipnumber]=useState('')\n// const [recipemail, setRecipemail]=useState('')\n// const [recipwebsite, setRecipwebsite]=useState('')\n// const [extend, setExtend]=useState(false)\nvar convoinfo=props.convoinfo,setConvoinfo=props.setConvoinfo,el=props.el,setChatuser=props.setChatuser,chatuser=props.chatuser;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),recipimg=_useState2[0],setRecipimg=_useState2[1];// const {recipname, setRecipname, sendername, setSendername}=props\nvar _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),recipname=_useState4[0],setRecipname=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),sendername=_useState6[0],setSendername=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),activestatus=_useState8[0],setActivestatus=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),senderimg=_useState10[0],setSenderimg=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),msg=_useState14[0],setMsg=_useState14[1];var reg=/((?:(?!(?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)).)+)|((?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)(?:\\?\\S+=\\S*(?:&\\S+=\\S*)*)?)/gm;function ytVidId(url){var p=/^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;return url.match(p)?RegExp.$1:false;}var user=firebase.auth().currentUser;function determineMsgtype(msg){if(msg.message!==undefined){if(msg.base64){return\"<span style='font-size: 0px; position: absolute'>\".concat(msg.message,\"</span><img src=\\\"\").concat(msg.message,\"\\\"/>\");}else if(msg.file){return'Sent a File';}else if(msg.audio){return'Sent a recording';}else if(ytVidId(msg.message)){return'Sent a Video';}else{return msg.message.replace(reg,function(_,text,img){return text?\"<p>\".concat(text.trim(),\"</p>\"):\"<img src=\\\"\".concat(img,\"\\\" />\");});}}}function lastMsg(msg){if(msg){if(msg.senderid===user.uid){return\"<p>You:</p> \".concat(determineMsgtype(msg));}else{return determineMsgtype(msg);}}}useEffect(function(){db.collection('users').doc(el.convoinfo.recipientid).onSnapshot(function(snap){var user=snap.data();setRecipname(user.userinfo.name);setRecipimg(user.userinfo.cover);setActivestatus(user.userinfo.online);setLoading(false);});db.collection('users').doc(el.convoinfo.creatorid).onSnapshot(function(snap){var user=snap.data();setSendername(user.userinfo.name);setSenderimg(user.userinfo.cover);setLoading(false);});db.collection('conversations').doc(el.convoinfo.convoid).onSnapshot(function(snap){var msgs=snap.data();setMsg(msgs.messages[msgs.messages.length-1]);});},[el.convoinfo.recipientid,el,chatuser]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavLink,{activeClassName:\"activelink\",to:'/chat/'+el.convoinfo.convoid,onClick:function onClick(){setChatuser(el.convoinfo.creatorid===user.uid?el.convoinfo.recipientid:el.convoinfo.creatorid);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"user\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"profilepic\",children:loading?/*#__PURE__*/_jsxs(\"div\",{class:\"lds-ring\",children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"div\",{})]}):/*#__PURE__*/_jsx(\"img\",{src:el.convoinfo.creatorid===user.uid?recipimg:senderimg,alt:\"\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"info flex\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"username\",children:el.convoinfo.creatorid===user.uid?recipname.length>15?recipname.slice(0,15)+'...':recipname:sendername.length>15?sendername.slice(0,15)+'...':sendername}),/*#__PURE__*/_jsx(\"small\",{dangerouslySetInnerHTML:{__html:lastMsg(msg)}})]})]})})});}export default Users;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Router","Switch","Route","Link","NavLink","Redirect","firebase","db","Users","props","convoinfo","setConvoinfo","el","setChatuser","chatuser","recipimg","setRecipimg","recipname","setRecipname","sendername","setSendername","activestatus","setActivestatus","senderimg","setSenderimg","loading","setLoading","msg","setMsg","reg","ytVidId","url","p","match","RegExp","$1","user","auth","currentUser","determineMsgtype","message","undefined","base64","file","audio","replace","_","text","img","trim","lastMsg","senderid","uid","collection","doc","recipientid","onSnapshot","snap","data","userinfo","name","cover","online","creatorid","convoid","msgs","messages","length","slice","__html"],"sources":["/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/src/components/Users.js"],"sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport { BrowserRouter as Router,Switch,Route,Link,NavLink, Redirect } from \"react-router-dom\" \r\nimport firebase from 'firebase'\r\nimport {db} from '../Fire'\r\nfunction Users (props) {\r\n  // const [name, setName]=useState('')\r\n  // const [img, setImg]=useState('')\r\n  // const [city, setCity]=useState('')\r\n  // const [country, setCountry]=useState('')\r\n  // const [job, setJob]=useState('')\r\n  // const [recipnumber, setRecipnumber]=useState('')\r\n  // const [recipemail, setRecipemail]=useState('')\r\n  // const [recipwebsite, setRecipwebsite]=useState('')\r\n  // const [extend, setExtend]=useState(false)\r\n    const {convoinfo, setConvoinfo, el, setChatuser, chatuser}=props\r\n    const [recipimg, setRecipimg]=useState('')\r\n    // const {recipname, setRecipname, sendername, setSendername}=props\r\n    const [recipname, setRecipname] = useState('')\r\n    const [sendername, setSendername]=useState('')\r\n    const [activestatus, setActivestatus]=useState(false)\r\n    const [senderimg, setSenderimg]=useState('')\r\n    const [loading, setLoading]=useState(true)\r\n    const [msg, setMsg]=useState('')\r\n    const reg = /((?:(?!(?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)).)+)|((?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)(?:\\?\\S+=\\S*(?:&\\S+=\\S*)*)?)/gm\r\n    function ytVidId(url) {\r\n      var p = /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\r\n    return (url.match(p)) ? RegExp.$1 : false\r\n    }\r\n    let user = firebase.auth().currentUser\r\n    function determineMsgtype(msg){\r\n      if(msg.message!==undefined){\r\n        if(msg.base64){\r\n          return `<span style='font-size: 0px; position: absolute'>${msg.message}</span><img src=\"${msg.message}\"/>`\r\n        }else if(msg.file){\r\n        return 'Sent a File'\r\n        }else if(msg.audio){\r\n            return 'Sent a recording'\r\n        }\r\n        else if(ytVidId(msg.message)){\r\n          return 'Sent a Video'\r\n        }\r\n        else {\r\n          return msg.message.replace(reg, (_, text, img) => text ? `<p>${text.trim()}</p>` : `<img src=\"${img}\" />`)\r\n\r\n        }\r\n      }\r\n\r\n    }\r\n    function lastMsg(msg) {\r\n      if(msg) {\r\n        if(msg.senderid===user.uid) {\r\n          return `<p>You:</p> ${determineMsgtype(msg)}`\r\n        }else {\r\n          return determineMsgtype(msg)\r\n       }\r\n      }\r\n     \r\n    }\r\n    useEffect(()=>{\r\n      db.collection('users').doc(el.convoinfo.recipientid).onSnapshot(snap=>{\r\n        const user = snap.data()\r\n        setRecipname(user.userinfo.name)\r\n        setRecipimg(user.userinfo.cover)\r\n        setActivestatus(user.userinfo.online)\r\n        setLoading(false)\r\n      })\r\n      db.collection('users').doc(el.convoinfo.creatorid).onSnapshot(snap=>{\r\n        const user = snap.data()\r\n        setSendername(user.userinfo.name)\r\n        setSenderimg(user.userinfo.cover)\r\n        setLoading(false)\r\n      })\r\n      db.collection('conversations').doc(el.convoinfo.convoid).onSnapshot(snap=>{\r\n        const msgs = snap.data()  \r\n        setMsg(msgs.messages[msgs.messages.length-1])\r\n      })\r\n    },[el.convoinfo.recipientid, el, chatuser])\r\n    return (\r\n   <>\r\n  <NavLink activeClassName='activelink' to={'/chat/'+el.convoinfo.convoid} onClick={()=>{setChatuser(el.convoinfo.creatorid===user.uid?el.convoinfo.recipientid:el.convoinfo.creatorid)}}>\r\n      <div className=\"user\">\r\n          <div className=\"profilepic\">\r\n          {loading?<div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div>: <img src={el.convoinfo.creatorid===user.uid?recipimg:senderimg} alt=\"\"/>}\r\n          </div>\r\n        <div className=\"info flex\">\r\n          <p className='username'>{el.convoinfo.creatorid===user.uid?recipname.length>15?recipname.slice(0, 15)+'...':recipname:sendername.length>15?sendername.slice(0, 15)+'...':sendername}</p>\r\n          <small dangerouslySetInnerHTML={{__html: lastMsg(msg)}}></small>        \r\n          </div>\r\n      </div>\r\n  </NavLink>\r\n  </>\r\n  )\r\n}\r\nexport default Users"],"mappings":"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"},"metadata":{},"sourceType":"module"}