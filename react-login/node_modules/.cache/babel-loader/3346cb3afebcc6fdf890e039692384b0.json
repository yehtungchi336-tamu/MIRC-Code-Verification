{"ast":null,"code":"import _slicedToArray from\"/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext}from\"react\";import firebase from\"firebase\";import{db}from\"../Fire\";import{CSSTransition,TransitionGroup}from\"react-transition-group\";import{BrowserRouter as Router,Switch,Route,Link,NavLink,Redirect,useLocation}from\"react-router-dom\";import Usersettings from\"./Usersettings\";import{ContextApp}from\"../ContextAPI\";import Calendars from\"./Calendars\";import Hoverlink from\"./Hoverlink\";import ElapsedTime from\"./Elapsedtime\";import ReactTimeAgo from'react-time-ago';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Notifications(props){var _useContext=useContext(ContextApp),themecolor=_useContext.themecolor;var setChatuser=props.setChatuser;var user=firebase.auth().currentUser;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),cover=_useState2[0],setCover=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),notifi=_useState4[0],setNotifLength=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),notifications=_useState6[0],setNotifications=_useState6[1];var imageRegexB=/(?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)/g;function determineNotiMsg(msg){if(msg.gif){return'Sent a GIF';}else if(msg.file){return'Sent a file';}else if(msg.video){return'Sent a video';}else if(msg.base64||msg.notifimsg.match(imageRegexB)!=null){return'Sent a photo';}else{return msg.notifimsg;}}var id=db.collection('users').doc().id;function deleteNotifi(el){notifications&&notifications.map(function(noti){if(el.notifiid===noti.notifiid){var itemindex=notifications.indexOf(noti);notifications.splice(itemindex,1);db.collection('notifications').doc(user.uid).update({notifications:notifications});}});}function deleteAllNotifi(){db.collection('notifications').doc(user.uid).update({notifications:[]});}var notificationsrow=notifications&&notifications.slice(0).reverse().map(function(noti){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Link,{to:'/chat/'+noti.id,onClick:function onClick(){setChatuser(noti.senderid);deleteNotifi(noti);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"notification flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"userprofile\",children:/*#__PURE__*/_jsx(\"img\",{src:cover,alt:\"\"})}),/*#__PURE__*/_jsxs(\"strong\",{children:[\" \",/*#__PURE__*/_jsxs(\"p\",{children:[\"From: \",noti.sender]})]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Message: \",determineNotiMsg(noti)]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Sent: \",/*#__PURE__*/_jsx(ReactTimeAgo,{date:noti.notifidate.toDate(),locale:\"en-US\"})]})]})}),/*#__PURE__*/_jsx(\"i\",{className:\"fal fa-times\",onClick:function onClick(){return deleteNotifi(noti);}})]});});useEffect(function(){db.collection('notifications').doc(user.uid).onSnapshot(function(snap){var notifi=snap.data();setNotifLength(notifi.notifications.length);setNotifications(notifi.notifications);setCover(notifi.notifications.cover);});},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"notificationspage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tp\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header flexrow \",children:[/*#__PURE__*/_jsx(\"i\",{class:\"far fa-inbox\",style:{color:themecolor,cursor:'auto'}}),/*#__PURE__*/_jsx(\"h2\",{children:\"Your Notifications\"})]}),/*#__PURE__*/_jsx(\"hr\",{style:{width:'100%'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"notificationsrow flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"notifiBtnCont\",children:/*#__PURE__*/_jsx(\"button\",{className:\" themeBtn notifiBtn\",onClick:function onClick(){return deleteAllNotifi();},children:\"Clear Notifications \"})}),notificationsrow]})]});}export default Notifications;","map":{"version":3,"names":["React","useState","useEffect","useContext","firebase","db","CSSTransition","TransitionGroup","BrowserRouter","Router","Switch","Route","Link","NavLink","Redirect","useLocation","Usersettings","ContextApp","Calendars","Hoverlink","ElapsedTime","ReactTimeAgo","Notifications","props","themecolor","setChatuser","user","auth","currentUser","cover","setCover","notifi","setNotifLength","notifications","setNotifications","imageRegexB","determineNotiMsg","msg","gif","file","video","base64","notifimsg","match","id","collection","doc","deleteNotifi","el","map","noti","notifiid","itemindex","indexOf","splice","uid","update","deleteAllNotifi","notificationsrow","slice","reverse","senderid","sender","notifidate","toDate","onSnapshot","snap","data","length","color","cursor","width"],"sources":["/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/src/components/Notifications.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport firebase from \"firebase\";\r\nimport { db } from \"../Fire\";\r\nimport { CSSTransition, TransitionGroup } from \"react-transition-group\";\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Link,\r\n  NavLink,\r\n  Redirect,\r\n  useLocation\r\n} from \"react-router-dom\";\r\nimport Usersettings from \"./Usersettings\";\r\nimport { ContextApp } from \"../ContextAPI\";\r\nimport Calendars from \"./Calendars\";\r\nimport Hoverlink from \"./Hoverlink\";\r\nimport ElapsedTime from \"./Elapsedtime\";\r\nimport ReactTimeAgo from 'react-time-ago'\r\nfunction Notifications(props) {\r\n  const { themecolor } = useContext(ContextApp);\r\n  const {setChatuser} = props\r\n  const user = firebase.auth().currentUser;\r\n  const [cover, setCover] = useState(\"\");\r\n  const [notifi, setNotifLength]=useState(0)\r\n  const [notifications, setNotifications]=useState([])\r\n\r\n  const imageRegexB = /(?:https?|ftp):\\/\\/[\\S]*\\.(?:png|jpe?g|gif|svg|webp)/g;\r\n\r\n  function determineNotiMsg(msg){\r\n    if(msg.gif){\r\n      return 'Sent a GIF'\r\n    }else if(msg.file){\r\n      return 'Sent a file'\r\n    }else if(msg.video){\r\n      return 'Sent a video'\r\n    }else if(msg.base64||msg.notifimsg.match(imageRegexB) != null){\r\n      return 'Sent a photo'\r\n    }\r\n    else {\r\n      return msg.notifimsg\r\n    }\r\n  }\r\n  const id =db.collection('users').doc().id\r\n  function deleteNotifi(el){\r\n      notifications && notifications.map(noti=>{\r\n        if(el.notifiid===noti.notifiid){\r\n          let itemindex = notifications.indexOf(noti)\r\n          notifications.splice(itemindex, 1)\r\n          db.collection('notifications').doc(user.uid).update({\r\n            notifications: notifications\r\n          })\r\n        }\r\n      })\r\n  }\r\n  function deleteAllNotifi(){\r\n    db.collection('notifications').doc(user.uid).update({\r\n      notifications: []\r\n    })\r\n  }\r\n  const notificationsrow = notifications && notifications.slice(0).reverse().map(noti=>{\r\n    return <div ><Link to={'/chat/'+noti.id} onClick={()=>{setChatuser(noti.senderid); deleteNotifi(noti)}}>\r\n    <div className=\"notification flex\">\r\n      <div className=\"userprofile\">\r\n        <img src={cover} alt=\"\"/>\r\n      </div>\r\n     <strong> <p>From: {noti.sender}</p></strong>\r\n      <span>Message: {determineNotiMsg(noti)}</span>\r\n      <span>Sent: <ReactTimeAgo date={noti.notifidate.toDate()} locale='en-US'/></span>\r\n      \r\n   </div>\r\n    </Link>\r\n    <i className=\"fal fa-times\" onClick={()=>deleteNotifi(noti)}></i></div>\r\n  })\r\n  useEffect(()=>{\r\n    \r\n    db.collection('notifications').doc(user.uid).onSnapshot(snap=>{\r\n      const notifi = snap.data()\r\n      setNotifLength(notifi.notifications.length)\r\n      setNotifications(notifi.notifications)\r\n      setCover(notifi.notifications.cover)\r\n    }) \r\n  },[])\r\n  return (\r\n    <div className=\"notificationspage\">\r\n      <div className=\"tp\">\r\n      <div className=\"header flexrow \">\r\n      <i class=\"far fa-inbox\" style={{color: themecolor, cursor: 'auto'}}></i>\r\n        <h2>Your Notifications</h2>\r\n      </div>   \r\n       <hr style={{width: '100%'}}/>\r\n      </div>\r\n      <div className=\"notificationsrow flex\">\r\n        <div className='notifiBtnCont'>\r\n          <button className=' themeBtn notifiBtn' onClick={()=>deleteAllNotifi()}>Clear Notifications </button>\r\n          </div>\r\n        {notificationsrow}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\nexport default Notifications;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}