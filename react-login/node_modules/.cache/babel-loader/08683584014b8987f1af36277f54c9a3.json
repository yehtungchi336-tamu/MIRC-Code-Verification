{"ast":null,"code":"import _slicedToArray from\"/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext}from'react';import{NavLink}from'react-router-dom';import Users from'./Users';import{db}from'../Fire';import firebase from'firebase';import{ContextApp}from'../ContextAPI';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Userrow(props){var _useContext=useContext(ContextApp),themecolor=_useContext.themecolor;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),keyword=_useState2[0],setKeyword=_useState2[1];var pattern=new RegExp('\\\\b'+keyword.replace(/[\\W_]+/g,\"\"),'i');var convoinfo=props.convoinfo,setConvoinfo=props.setConvoinfo,setChatuser=props.setChatuser,chatuser=props.chatuser;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),userlist=_useState4[0],setUserlist=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),convos=_useState6[0],setConvos=_useState6[1];var id=db.collection('users').doc().id;var user=firebase.auth().currentUser;var allconvos=convos&&convos.sort(function(a,b){return b.lastmsgdate-a.lastmsgdate;}).map(function(el){if(user){return/*#__PURE__*/_jsx(Users,{chatuser:chatuser,setChatuser:setChatuser,el:el,convoinfo:convoinfo,setConvoinfo:setConvoinfo});}else{return null;}});useEffect(function(){db.collection('users').doc(user.uid).onSnapshot(function(user){var userlist=user.data();setUserlist(userlist);db.collection('conversations').onSnapshot(function(snap){var convos=[];snap.forEach(function(doc){if(userlist.msgids.includes(doc.id)){convos.push(doc.data());}});setConvos(convos);});});},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Chats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search abs\",children:[/*#__PURE__*/_jsx(\"i\",{class:\"far fa-plus\",style:{color:themecolor},onClick:function onClick(){return props.setAdduser();}}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search\",onFocus:function onFocus(){return props.setAdduser();}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"users\",children:allconvos})]});}export default Userrow;","map":{"version":3,"names":["React","useState","useEffect","useContext","NavLink","Users","db","firebase","ContextApp","Userrow","props","themecolor","keyword","setKeyword","pattern","RegExp","replace","convoinfo","setConvoinfo","setChatuser","chatuser","userlist","setUserlist","convos","setConvos","id","collection","doc","user","auth","currentUser","allconvos","sort","a","b","lastmsgdate","map","el","uid","onSnapshot","data","snap","forEach","msgids","includes","push","color","setAdduser"],"sources":["/Users/jinsonwu/Desktop/MIRC-Code-Verification/react-login/src/components/Userrow.js"],"sourcesContent":["import React, {useState, useEffect, useContext} from 'react'\r\nimport { NavLink } from 'react-router-dom'\r\nimport Users from './Users'\r\nimport {db} from '../Fire'\r\nimport firebase from 'firebase'\r\nimport { ContextApp } from '../ContextAPI'\r\n\r\nfunction Userrow (props) {\r\n  const {themecolor}=useContext(ContextApp)\r\n  const [keyword, setKeyword]=useState('')\r\n  const pattern = new RegExp('\\\\b' + keyword.replace(/[\\W_]+/g,\"\"), 'i')\r\n\r\n    const {convoinfo, setConvoinfo, setChatuser, chatuser}= props \r\n    const [userlist, setUserlist]=useState([])\r\n    const [convos, setConvos]=useState([])\r\n    const id =db.collection('users').doc().id\r\n    const  user = firebase.auth().currentUser\r\n    const allconvos = convos && convos.sort((a, b) => b.lastmsgdate - a.lastmsgdate).map(el=>{\r\n      if(user){\r\n          return <Users   chatuser={chatuser} setChatuser={setChatuser} el={el} convoinfo={convoinfo} setConvoinfo={setConvoinfo}/>    \r\n\r\n      }else {\r\n        return null\r\n      }\r\n    })\r\n    useEffect(()=>{\r\n     db.collection('users').doc(user.uid).onSnapshot(user=>{\r\n       const userlist = user.data()\r\n       setUserlist(userlist)\r\n       db.collection('conversations').onSnapshot(snap=>{\r\n         let convos = []\r\n          snap.forEach(doc=>{\r\n            if(userlist.msgids.includes(doc.id)){\r\n              convos.push(doc.data())\r\n            }\r\n          })\r\n          setConvos(convos)\r\n       })\r\n     })\r\n    },[])\r\n  return (\r\n   <>\r\n    <h2>Chats</h2>\r\n     <div className=\"search abs\">\r\n      \r\n       <i class=\"far fa-plus\" style={{color: themecolor}} onClick={()=>props.setAdduser()}></i>\r\n       <input type=\"text\" placeholder='Search' onFocus={()=>props.setAdduser()}/>\r\n     </div> \r\n   \r\n     <div className=\"users\">\r\n     {allconvos}     \r\n     </div>\r\n    \r\n  </>\r\n  )\r\n}\r\nexport default Userrow"],"mappings":"gJAAA,MAAOA,MAAK,EAAGC,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAO,OAAO,CAC5D,OAASC,OAAO,KAAQ,kBAAkB,CAC1C,MAAOC,MAAK,KAAM,SAAS,CAC3B,OAAQC,EAAE,KAAO,SAAS,CAC1B,MAAOC,SAAQ,KAAM,UAAU,CAC/B,OAASC,UAAU,KAAQ,eAAe,8IAE1C,QAASC,QAAO,CAAEC,KAAK,CAAE,CACvB,gBAAmBP,UAAU,CAACK,UAAU,CAAC,CAAlCG,UAAU,aAAVA,UAAU,CACjB,cAA4BV,QAAQ,CAAC,EAAE,CAAC,wCAAjCW,OAAO,eAAEC,UAAU,eAC1B,GAAMC,QAAO,CAAG,GAAIC,OAAM,CAAC,KAAK,CAAGH,OAAO,CAACI,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,CAAE,GAAG,CAAC,CAEpE,GAAOC,UAAS,CAAwCP,KAAK,CAAtDO,SAAS,CAAEC,YAAY,CAA0BR,KAAK,CAA3CQ,YAAY,CAAEC,WAAW,CAAaT,KAAK,CAA7BS,WAAW,CAAEC,QAAQ,CAAGV,KAAK,CAAhBU,QAAQ,CACrD,eAA8BnB,QAAQ,CAAC,EAAE,CAAC,yCAAnCoB,QAAQ,eAAEC,WAAW,eAC5B,eAA0BrB,QAAQ,CAAC,EAAE,CAAC,yCAA/BsB,MAAM,eAAEC,SAAS,eACxB,GAAMC,GAAE,CAAEnB,EAAE,CAACoB,UAAU,CAAC,OAAO,CAAC,CAACC,GAAG,EAAE,CAACF,EAAE,CACzC,GAAOG,KAAI,CAAGrB,QAAQ,CAACsB,IAAI,EAAE,CAACC,WAAW,CACzC,GAAMC,UAAS,CAAGR,MAAM,EAAIA,MAAM,CAACS,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,QAAKA,EAAC,CAACC,WAAW,CAAGF,CAAC,CAACE,WAAW,GAAC,CAACC,GAAG,CAAC,SAAAC,EAAE,CAAE,CACvF,GAAGT,IAAI,CAAC,CACJ,mBAAO,KAAC,KAAK,EAAG,QAAQ,CAAER,QAAS,CAAC,WAAW,CAAED,WAAY,CAAC,EAAE,CAAEkB,EAAG,CAAC,SAAS,CAAEpB,SAAU,CAAC,YAAY,CAAEC,YAAa,EAAE,CAE7H,CAAC,IAAK,CACJ,MAAO,KAAI,CACb,CACF,CAAC,CAAC,CACFhB,SAAS,CAAC,UAAI,CACbI,EAAE,CAACoB,UAAU,CAAC,OAAO,CAAC,CAACC,GAAG,CAACC,IAAI,CAACU,GAAG,CAAC,CAACC,UAAU,CAAC,SAAAX,IAAI,CAAE,CACpD,GAAMP,SAAQ,CAAGO,IAAI,CAACY,IAAI,EAAE,CAC5BlB,WAAW,CAACD,QAAQ,CAAC,CACrBf,EAAE,CAACoB,UAAU,CAAC,eAAe,CAAC,CAACa,UAAU,CAAC,SAAAE,IAAI,CAAE,CAC9C,GAAIlB,OAAM,CAAG,EAAE,CACdkB,IAAI,CAACC,OAAO,CAAC,SAAAf,GAAG,CAAE,CAChB,GAAGN,QAAQ,CAACsB,MAAM,CAACC,QAAQ,CAACjB,GAAG,CAACF,EAAE,CAAC,CAAC,CAClCF,MAAM,CAACsB,IAAI,CAAClB,GAAG,CAACa,IAAI,EAAE,CAAC,CACzB,CACF,CAAC,CAAC,CACFhB,SAAS,CAACD,MAAM,CAAC,CACpB,CAAC,CAAC,CACJ,CAAC,CAAC,CACH,CAAC,CAAC,EAAE,CAAC,CACP,mBACC,wCACC,6BAAc,cACb,aAAK,SAAS,CAAC,YAAY,wBAEzB,UAAG,KAAK,CAAC,aAAa,CAAC,KAAK,CAAE,CAACuB,KAAK,CAAEnC,UAAU,CAAE,CAAC,OAAO,CAAE,yBAAID,MAAK,CAACqC,UAAU,EAAE,EAAC,EAAK,cACxF,cAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAE,yBAAIrC,MAAK,CAACqC,UAAU,EAAE,EAAC,EAAE,GACtE,cAEN,YAAK,SAAS,CAAC,OAAO,UACrBhB,SAAS,EACJ,GAEN,CAEL,CACA,cAAetB,QAAO"},"metadata":{},"sourceType":"module"}